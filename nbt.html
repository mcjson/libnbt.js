<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <pre id="out"></pre>

    <input type="file" id="nbt" />
    <button type="button" id="go">Parse</button>
    <script type="module">
      import { parseNBT } from "./src/nbt/tag.js";
      import pako from "pako";

      const logClear = () => (document.querySelector("#out").innerHTML = "");

      const logOut = (s) => {
        document.querySelector("#out").innerHTML +=
          JSON.stringify(s, null, 2) + "\n";
      };

      document.querySelector("#go").addEventListener("click", async () => {
        let data = await document.querySelector("#nbt").files[0].arrayBuffer();
        const view = new Uint8Array(data);
        if (view[0] == 0x1f && view[1] == 0x8b) {
          console.log("GZIP detected, inflating");
          data = pako.inflate(data);
        } else {
          console.log("No GZIP detected");
        }
        logClear();
        logOut(parseNBT(data));
      });

      (async () => {
        const buffer = await new Blob([
          ...[new Uint8Array([10, 0, 5]), "hello"], //begin compound
          ...[new Uint8Array([1, 0, 4]), "BYTE", new Uint8Array([32])], // BYTE:  {byte: 32}
          new Uint8Array([0]), // END
        ]).arrayBuffer();
        logOut(parseNBT(buffer));
      })();
    </script>
  </body>
</html>
